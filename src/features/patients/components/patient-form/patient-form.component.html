<!-- Sliding Form Sidebar -->
<div
  class="fixed inset-y-0 right-0 z-50 w-full sm:w-96 bg-white dark:bg-gray-800 shadow-xl transform transition-transform duration-300 ease-in-out"
>
  <div class="flex flex-col h-full">
    <!-- Header -->
    <div
      class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700"
    >
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
        {{ patient() ? "Edit Patient" : "New Patient" }}
      </h2>
      <button
        (click)="onCancel()"
        class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"
      >
        <i class="ri-close-line text-xl"></i>
      </button>
    </div>

    <!-- Form Content -->
    <div class="flex-1 overflow-y-auto p-4">
      <form (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- Name -->
        <div>
          <label
            for="name"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Full Name *
          </label>
          <input
            id="name"
            type="text"
            required
            [value]="form().name"
            (input)="updateForm('name', $any($event.target).value)"
            [class]="
              'w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white' +
              (validationService.getFieldError('name')
                ? ' border-red-300 dark:border-red-600'
                : ' border-gray-300 dark:border-gray-600')
            "
            placeholder="Enter patient's full name"
          />
          <app-field-error
            [errorMessage]="validationService.getFieldError('name')"
          ></app-field-error>
        </div>

        <!-- Email -->
        <div>
          <label
            for="email"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Email Address *
          </label>
          <input
            id="email"
            type="email"
            required
            [value]="form().email"
            (input)="updateForm('email', $any($event.target).value)"
            [class]="
              'w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white' +
              (validationService.getFieldError('email')
                ? ' border-red-300 dark:border-red-600'
                : ' border-gray-300 dark:border-gray-600')
            "
            placeholder="Enter email address"
          />
          <app-field-error
            [errorMessage]="validationService.getFieldError('email')"
          ></app-field-error>
        </div>

        <!-- Phone -->
        <div>
          <label
            for="phone"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Phone Number *
          </label>
          <input
            id="phone"
            type="tel"
            required
            [value]="form().phone"
            (input)="updateForm('phone', $any($event.target).value)"
            [class]="
              'w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white' +
              (validationService.getFieldError('phone')
                ? ' border-red-300 dark:border-red-600'
                : ' border-gray-300 dark:border-gray-600')
            "
            placeholder="Enter phone number"
          />
          <app-field-error
            [errorMessage]="validationService.getFieldError('phone')"
          ></app-field-error>
        </div>

        <!-- Date of Birth -->
        <div>
          <label
            for="dateOfBirth"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Date of Birth *
          </label>
          <input
            id="dateOfBirth"
            type="date"
            required
            [value]="form().dateOfBirth"
            (input)="updateForm('dateOfBirth', $any($event.target).value)"
            [class]="
              'w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white' +
              (validationService.getFieldError('dateOfBirth')
                ? ' border-red-300 dark:border-red-600'
                : ' border-gray-300 dark:border-gray-600')
            "
          />
          <app-field-error
            [errorMessage]="validationService.getFieldError('dateOfBirth')"
          ></app-field-error>
        </div>

        <!-- Address -->
        <div>
          <label
            for="address"
            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
          >
            Address *
          </label>
          <textarea
            id="address"
            rows="3"
            required
            [value]="form().address"
            (input)="updateForm('address', $any($event.target).value)"
            [class]="
              'w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white' +
              (validationService.getFieldError('address')
                ? ' border-red-300 dark:border-red-600'
                : ' border-gray-300 dark:border-gray-600')
            "
            placeholder="Enter complete address"
          >
          </textarea>
          <app-field-error
            [errorMessage]="validationService.getFieldError('address')"
          ></app-field-error>
        </div>
      </form>
    </div>

    <!-- Footer Actions -->
    <div
      class="flex items-center justify-end space-x-3 p-4 border-t border-gray-200 dark:border-gray-700"
    >
      <button
        type="button"
        (click)="onCancel()"
        class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
      >
        Cancel
      </button>
      <button
        type="submit"
        (click)="onSubmit()"
        [disabled]="isLoading()"
        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        @if (isLoading()) {
        <i class="ri-loader-4-line animate-spin mr-2"></i>
        Saving... } @else {
        <i class="ri-save-line mr-2"></i>
        {{ patient() ? "Update" : "Create" }} Patient }
      </button>
    </div>
  </div>
</div>

<!-- Backdrop -->
<div
  class="fixed inset-0 bg-black bg-opacity-50 z-40"
  (click)="onCancel()"
></div>
