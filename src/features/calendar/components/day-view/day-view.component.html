<div class="h-full flex flex-col w-full bg-white dark:bg-gray-900">
  <!-- Day Header -->
  <div
    class="border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 px-6 py-4"
  >
    <div class="flex items-center justify-center">
      <div>
        <!-- <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
          {{
            currentDate().toLocaleDateString("en-US", {
              weekday: "long",
              year: "numeric",
              month: "long",
              day: "numeric"
            })
          }}
        </h1> -->
        <p
          class="text-sm text-gray-500 dark:text-gray-400 mt-1 flex item-center justify-center"
        >
          @if (isToday(currentDate())) {
          <span class="text-blue-600 dark:text-blue-400 font-medium"
            >Today</span
          >
          } @else if (isYesterday(currentDate())) {
          <span class="text-orange-600 dark:text-orange-400 font-medium"
            >Yesterday</span
          >
          } @else if (isTomorrow(currentDate())) {
          <span class="text-green-600 dark:text-green-400 font-medium"
            >Tomorrow</span
          >
          } @else {
          {{ getRelativeDateDescription(currentDate()) }}
          }
        </p>
      </div>
      @if (isHoliday()) {
      <div class="flex items-center space-x-2">
        <i class="ri-gift-line text-red-500 dark:text-red-400 text-xl"></i>
        <span class="text-sm font-medium text-red-600 dark:text-red-400">
          {{ getHolidayDetails()?.title || "Holiday" }}
        </span>
      </div>
      }
    </div>
  </div>

  <!-- Check if clinic is closed -->
  @if (!isWorkingDay()) {
  <!-- Clinic Closed Message -->
  <div
    class="flex-1 flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900"
  >
    <div class="text-center p-8 max-w-md">
      <div class="mb-4">
        @if (isWeekend()) {
        <i
          class="ri-calendar-close-line text-6xl text-blue-500 dark:text-blue-400 mb-4"
        ></i>
        } @else if (isHoliday()) {
        <i
          class="ri-calendar-event-line text-6xl text-green-500 dark:text-green-400 mb-4"
        ></i>
        } @else {
        <i
          class="ri-time-line text-6xl text-orange-500 dark:text-orange-400 mb-4"
        ></i>
        }
      </div>

      <!-- Holiday-specific styling with green icon -->
      @if (isHoliday()) {
      <div class="text-center py-8">
        <div class="mb-4">
          <i class="ri-calendar-event-line text-6xl text-green-500"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
          Holiday - Clinic Closed
        </h3>
        <p class="text-gray-600 dark:text-gray-300 mb-6">
          The clinic is closed today due to a holiday. We'll be back tomorrow!
        </p>
      </div>
      } @else if (isWeekend()) {
      <div class="text-center py-8">
        <div class="mb-4">
          <i class="ri-calendar-line text-6xl text-blue-500"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
          Weekend - Clinic Closed
        </h3>
        <p class="text-gray-600 dark:text-gray-300 mb-6">
          Enjoy your weekend! We'll be back on Monday.
        </p>
      </div>
      } @else {
      <div class="text-center py-8">
        <div class="mb-4">
          <i class="ri-time-line text-6xl text-orange-500"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
          Clinic Closed
        </h3>
        <p class="text-gray-600 dark:text-gray-300 mb-6">
          The clinic is closed today. Please check our operating hours.
        </p>
      </div>
      }
      <div
        class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700"
      >
        <p class="text-sm text-gray-500 dark:text-gray-400">
          <i class="ri-time-line mr-2"></i>
          Regular Hours: Monday - Friday, 8:00 AM - 6:00 PM
        </p>
      </div>
    </div>
  </div>
  } @else {

  <!-- Time slots with enhanced styling -->
  <div class="flex-1 overflow-auto">
    <div class="relative w-full" #gridContainer>
      <!-- Current time indicator -->
      @if (isCurrentTimeVisible) {
      <div
        class="absolute left-0 right-0 z-50 pointer-events-none current-time-indicator"
        [style.top.px]="getCurrentTimePosition()"
      >
        <!-- Time label -->
        <div class="absolute left-0 w-20 flex justify-end pr-4">
          <div
            class="bg-blue-500 dark:bg-blue-400 text-white dark:text-gray-900 text-xs px-2 py-1 rounded-full shadow-lg time-label"
          >
            {{
              currentTime.toLocaleTimeString("en-US", {
                hour12: false,
                hour: "2-digit",
                minute: "2-digit"
              })
            }}
          </div>
        </div>

        <!-- Current time line -->
        <div
          class="absolute h-0.5 bg-blue-500 dark:bg-blue-400 shadow-lg time-line"
          style="left: 5rem; right: 0"
        >
          <!-- Circular indicator at the start -->
          <div
            class="absolute -left-1 -top-1 w-2 h-2 bg-blue-500 dark:bg-blue-400 rounded-full shadow-lg time-dot"
          ></div>
        </div>
      </div>
      } @for (timeSlot of timeSlots; track timeSlot) {
      <div
        [class]="
          'flex items-stretch border-b border-gray-400 dark:border-gray-600 time-slot ' +
          (isTimeSlotBlocked(timeSlot) ? ' blocked' : '')
        "
      >
        <!-- Time label -->
        <div
          [class]="
            'w-20 flex-shrink-0 text-sm text-right pr-4 bg-gray-50 dark:bg-gray-700 flex items-center justify-end border-r border-gray-200 dark:border-gray-600 ' +
            (isRestrictedTimeSlot(timeSlot) || isPastTimeSlot(timeSlot)
              ? 'text-gray-400 dark:text-gray-500'
              : 'text-gray-600 dark:text-gray-400')
          "
          style="min-height: 65px"
        >
          {{ timeSlot }}
        </div>

        <!-- Appointments -->
        <div
          class="flex-1 min-h-[65px] relative overflow-visible bg-white dark:bg-gray-900"
        >
          @if (getAppointmentsForTimeSlot(timeSlot).length === 0) {
          <!-- Check if time slot is occupied by a spanning appointment -->
          @if (isTimeSlotOccupied(timeSlot)) {
          <!-- Time slot is occupied by a spanning appointment -->
          <div class="flex">
            <div
              [class]="
                'flex-1 h-10 rounded-md mr-2 ' +
                (isPastTimeSlot(timeSlot)
                  ? ''
                  : 'bg-transparent border-2 border-dashed border-gray-300 dark:border-gray-600 opacity-30')
              "
            ></div>
            <!-- Clickable area for new appointments (25% of the width) - only show if not past time slot -->
            @if (!isPastTimeSlot(timeSlot)) {
            <div
              (click)="
                !isRestrictedTimeSlot(timeSlot)
                  ? onTimeSlotClick(timeSlot)
                  : null
              "
              [ngClass]="{
                'w-1/4 h-10 border border-dashed rounded-md transition-colors flex items-center justify-center': true,
                'restricted-clickable-area': isRestrictedTimeSlot(timeSlot),
                'cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20 border-gray-300 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-600':
                  !isRestrictedTimeSlot(timeSlot),
                'weekend-time-slot': !isWorkingDay(),
                'holiday-time-slot': isHoliday()
              }"
              [title]="
                isRestrictedTimeSlot(timeSlot)
                  ? !isWorkingDay()
                    ? 'Clinic closed on this day'
                    : isHoliday()
                    ? 'Clinic closed on holidays'
                    : 'Cannot create appointments in the past'
                  : 'Click to create new appointment'
              "
            >
              @if (!isRestrictedTimeSlot(timeSlot)) {
              <i
                class="ri-add-line text-gray-400 hover:text-blue-500 text-sm"
              ></i>
              }
            </div>
            } @else {
            <!-- Past time slot - no clickable area -->
            <div class="w-1/4"></div>
            }
          </div>
          } @else {
          <!-- Empty time slot - show clickable area only if not past time -->
          @if (!isPastTimeSlot(timeSlot)) {
          <div
            (click)="
              !isRestrictedTimeSlot(timeSlot) ? onTimeSlotClick(timeSlot) : null
            "
            [ngClass]="{
              'w-full h-10 border border-dashed rounded-md transition-colors': true,
              'flex items-center justify-center': !isLunchBreak(
                currentDate(),
                timeSlot
              ),
              'restricted-clickable-area': isRestrictedTimeSlot(timeSlot),
              'cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20 border-gray-300 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-600':
                !isRestrictedTimeSlot(timeSlot),
              'weekend-time-slot': !isWorkingDay(),
              'holiday-time-slot': isHoliday()
            }"
            [title]="
              isRestrictedTimeSlot(timeSlot)
                ? isLunchBreak(currentDate(), timeSlot)
                  ? '🍽️ Lunch Break - No appointments allowed during lunch time'
                  : !isWorkingDay()
                  ? '🚫 Clinic closed - Weekend appointments are not allowed. Please schedule during working days.'
                  : isHoliday()
                  ? '🎉 Clinic closed - No appointments on holidays. Please choose a working day.'
                  : '⏰ Past time - Cannot create appointments in the past. Please select a future time slot.'
                : '✨ Click to create new appointment - Available time slot'
            "
          >
            @if (!isRestrictedTimeSlot(timeSlot)) {
            <i class="ri-add-line text-gray-400 hover:text-blue-500"></i>
            } @else if (isLunchBreak(currentDate(), timeSlot)) {
            <!-- Lunch break indicator -->
            <app-lunch-break></app-lunch-break>
            } @else {
            <!-- Show 🚫 icon for all other restricted time slots -->
            <i
              class="ri-forbid-line text-gray-400 dark:text-gray-500 text-lg opacity-60"
              title="Restricted - No appointments allowed"
            ></i>
            }
          </div>
          } @else {
          <!-- Past time slot - just show empty space -->
          <div class="w-full h-10"></div>
          } } } @else {
          <!-- Appointments starting at this time slot -->
          <div class="flex">
            <!-- Appointments container (75% width) -->
            <div
              class="flex-1 relative overflow-visible mr-2"
              style="z-index: 10"
            >
              @for (appointmentData of
              getOverlappingAppointments(getAppointmentsForTimeSlot(timeSlot));
              track appointmentData.appointment.id) {
              <div
                [style.left]="
                  appointmentData.column * (75 / appointmentData.totalColumns) +
                  '%'
                "
                [style.width]="75 / appointmentData.totalColumns + '%'"
                [style.z-index]="30 - appointmentData.column"
                [style.top.px]="
                  getAppointmentTopOffset(appointmentData.appointment, timeSlot)
                "
                [class]="'appointment-card-wrapper absolute overflow-visible'"
              >
                <app-appointment-card
                  [appointment]="appointmentData.appointment"
                  [settings]="settings()"
                  [compact]="false"
                  [enableResize]="
                    !isPastAppointment(appointmentData.appointment)
                  "
                  [enableDrag]="!isPastAppointment(appointmentData.appointment)"
                  [slotHeight]="65"
                  [doctors]="doctors()"
                  [gridContainer]="gridContainer"
                  [viewType]="'day'"
                  (click)="
                    onAppointmentClick(appointmentData.appointment, $event);
                    debugAppointment(appointmentData.appointment)
                  "
                  (resizeStart)="onResizeStart($event)"
                  (resizeUpdate)="onResizeUpdate($event)"
                  (resizeComplete)="onResizeComplete($event)"
                  (dragStart)="onDragStart($event)"
                  (dragUpdate)="onDragUpdate($event)"
                  (dragComplete)="onDragComplete($event)"
                  [class]="
                    'block mr-1 ' +
                    (appointmentData.column > 0
                      ? 'shadow-lg border-2 border-white dark:border-gray-800'
                      : '')
                  "
                ></app-appointment-card>
              </div>
              }
            </div>

            <!-- Clickable area for new appointments (25% of the width) - only show if not past time slot -->
            @if (!isPastTimeSlot(timeSlot)) {
            <div
              (click)="
                !isRestrictedTimeSlot(timeSlot)
                  ? onTimeSlotClick(timeSlot)
                  : null
              "
              [ngClass]="{
                'w-1/4 h-10 border border-dashed rounded-md transition-colors flex items-center justify-center': true,
                'restricted-clickable-area': isRestrictedTimeSlot(timeSlot),
                'cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20 border-gray-300 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-600':
                  !isRestrictedTimeSlot(timeSlot),
                'weekend-time-slot': !isWorkingDay(),
                'holiday-time-slot': isHoliday()
              }"
              [title]="
                isRestrictedTimeSlot(timeSlot)
                  ? !isWorkingDay()
                    ? '🚫 Clinic closed - Weekend appointments are not allowed. Please schedule during working days.'
                    : isHoliday()
                    ? '🎉 Clinic closed - No appointments on holidays. Please choose a working day.'
                    : '⏰ Past time - Cannot create appointments in the past. Please select a future time slot.'
                  : '✨ Click to create new appointment - Available time slot'
              "
            >
              @if (!isRestrictedTimeSlot(timeSlot)) {
              <i
                class="ri-add-line text-gray-400 hover:text-blue-500 text-sm"
              ></i>
              } @else {
              <!-- Show 🚫 icon for all restricted time slots (consistent with month view) -->
              <i
                class="ri-forbid-line text-gray-400 dark:text-gray-500 text-lg opacity-60"
                title="Restricted - No appointments allowed"
              ></i>
              }
            </div>
            } @else {
            <!-- Past time slot - no clickable area, let appointments take full width -->
            <div class="w-1/4"></div>
            }
          </div>
          }
        </div>
      </div>
      }
    </div>
  </div>
  }

  <!-- Resize Confirmation Modal -->
  <app-resize-confirmation-modal
    [isOpen]="showResizeModal()"
    [appointment]="resizeAppointment()"
    [newEndTime]="newEndTime()"
    (confirm)="onResizeConfirm()"
    (cancel)="onResizeCancel()"
  ></app-resize-confirmation-modal>

  <!-- Drag and Drop Confirmation Modal -->
  @if (showDragDropModal()) {
  <app-drag-drop-confirmation
    [confirmationData]="dragDropConfirmation()"
    [isLoading]="isDragDropLoading()"
    (confirm)="onDragDropConfirm()"
    (cancel)="onDragDropCancel()"
  ></app-drag-drop-confirmation>
  }
</div>
